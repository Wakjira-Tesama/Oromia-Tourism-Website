//////////////////////App.js//////////////////////

import React, { useState, useEffect } from 'react';
import axios from 'axios';
import './App.css'; 

const App = () => {
  const [todos, setTodos] = useState([]);
  const [newTodo, setNewTodo] = useState('');
  const [filter, setFilter] = useState('All');
  const [editingId, setEditingId] = useState(null);
  const [editText, setEditText] = useState('');

  useEffect(() => {
    fetchTodos();
  }, []);

  const fetchTodos = async () => {
    const response = await axios.get('http://localhost:5000/api/todos');
    setTodos(response.data);
  };

  const addTodo = async () => {
    if (!newTodo) return; 
    const response = await axios.post('http://localhost:5000/api/todos', { title: newTodo });
    setTodos([...todos, response.data]);
    setNewTodo('');
  };

  const toggleTodo = async (id, completed) => {
    try {
      await axios.put(`http://localhost:5000/api/todos/${id}`, { completed: !completed });
      fetchTodos(); 
    } catch (error) {
      console.error('Error updating todo:', error);
    }
  };

  const deleteTodo = async (id) => {
    await axios.delete(`http://localhost:5000/api/todos/${id}`);
    fetchTodos();
  };

  const deleteDoneTodos = async () => {
    await axios.delete('http://localhost:5000/api/todos/done');
    fetchTodos();
  };

  const deleteAllTodos = async () => {
    await axios.delete('http://localhost:5000/api/todos/all');
    fetchTodos();
  };

  const startEdit = (todo) => {
    setEditingId(todo._id);
    setEditText(todo.title);
  };

  const handleEditChange = (e) => {
    setEditText(e.target.value);
  };

  const saveEdit = async (id) => {
    await axios.put(`http://localhost:5000/api/todos/${id}`, { title: editText });
    setEditingId(null);
    fetchTodos();
  };

  const filterTodos = (filter) => {
    setFilter(filter);
  };

  const getFilteredTodos = () => {
    switch (filter) {
      case 'All':
        return todos;
      case 'Done':
        return todos.filter(todo => todo.completed);
      case 'ToDo':
        return todos.filter(todo => !todo.completed);
      default:
        return todos;
    }
  };

  return (
    <div className="app">
      <h1>Todo List</h1>
      <div className="todo-input">
        <input
          type="text"
          value={newTodo}
          onChange={(e) => setNewTodo(e.target.value)}
          placeholder="New Todo"
        />
        <button onClick={addTodo}>Add new task</button>
      </div>
      <div className="filters">
        <button className={filter === 'All' ? 'selected' : ''} onClick={() => filterTodos('All')}>
          All
        </button>
        <button className={filter === 'Done' ? 'selected' : ''} onClick={() => filterTodos('Done')}>
          Done
        </button>
        <button className={filter === 'ToDo' ? 'selected' : ''} onClick={() => filterTodos('ToDo')}>
          ToDo
        </button>
      </div>
      <ul className="todo-list">
        {getFilteredTodos().map((todo) => (
          <li key={todo._id} className={todo.completed ? 'completed' : ''}>
            <div>
              <input
                type="checkbox"
                checked={todo.completed}
                onChange={() => toggleTodo(todo._id, todo.completed)}
                style={{ marginRight: '10px' }}
              />
              {editingId === todo._id ? (
                <input
                  type="text"
                  value={editText}
                  onChange={handleEditChange}
                  style={{ marginRight: '10px' }}
                />
              ) : (
                <span>{todo.title}</span>
              )}
            </div>
            <div>
              {editingId === todo._id ? (
                <button onClick={() => saveEdit(todo._id)}>Save</button>
              ) : (
                <button onClick={() => startEdit(todo)}>‚úèÔ∏è</button>
              )}
              <button onClick={() => deleteTodo(todo._id)}>üóëÔ∏è</button>
            </div>
          </li>
        ))}
      </ul>
      <div className="actions">
        <button onClick={deleteDoneTodos}>Delete done tasks</button>
        <button onClick={deleteAllTodos}>Delete all tasks</button>
      </div>
    </div>
  );
};

export default App;



////////////////////////App.css//////////////////////////

@import url('https://fonts.googleapis.com/css2?family=Parisienne&display=swap');

.app {
  width: 80%;
  margin: auto;
  text-align: center;
  background-color: #bed2e7; 
  padding: 20px; 
}

h1 {
  font-family: 'Parisienne', cursive; 
}

.todo-input, .filters, .actions {
  margin: 20px 0;
}

.todo-list {
  list-style: none;
  padding: 0;
}

.todo-list li {
  margin: 10px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.todo-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #ccc;
}

input[type="text"], input[type="checkbox"] {
  margin-right: 10px;
}

button {
  margin-left: 5px;
  padding: 5px 10px;
}

.todo-list li.completed span {
  text-decoration: line-through;
}

input[type="text"] {
  padding: 10px;
  width: 70%;
  margin-right: 10px;
}

button {
  padding: 10px 20px;
  cursor: pointer;
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 5px;
}

button:hover {
  background-color: #0056b3;
}

.selected {
  background-color: #034080;
}



////////////////////////////////Server.js//////////////////////////

const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');

const app = express();
app.use(cors());
app.use(express.json());

mongoose.connect('mongodb://localhost:27017/ToDoList', {
  useNewUrlParser: true,
  useUnifiedTopology: true,
});

const todoSchema = new mongoose.Schema({
  title: String,
  completed: Boolean,
}, { collection: 'ToDo' }); 

const Todo = mongoose.model('Todo', todoSchema);

app.get('/api/todos', async (req, res) => {
  const todos = await Todo.find();
  res.json(todos);
});

app.post('/api/todos', async (req, res) => {
  const newTodo = new Todo({
    title: req.body.title,
    completed: false,
  });
  await newTodo.save();
  res.json(newTodo);
});

app.put('/api/todos/:id', async (req, res) => {
  const { title, completed } = req.body;
  try {
    const updatedTodo = await Todo.findByIdAndUpdate(
      req.params.id,
      { $set: { title, completed } },
      { new: true }
    );
    res.json(updatedTodo);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

app.delete('/api/todos/done', async (req, res) => {
  try {
    await Todo.deleteMany({ completed: true });
    res.json({ message: 'Deleted done tasks' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

app.delete('/api/todos/all', async (req, res) => {
  try {
    await Todo.deleteMany({});
    res.json({ message: 'Deleted all tasks' });
 } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

app.delete('/api/todos/:id', async (req, res) => {
  try {
    await Todo.findByIdAndDelete(req.params.id);
    res.json({ message: 'Deleted' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

const PORT = 5000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

